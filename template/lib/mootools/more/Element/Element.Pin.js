(function(){var a=false,b=false;var c=function(){var d=new Element("div").setStyles({position:"fixed",top:0,right:0}).inject(document.body);a=(d.offsetTop===0);d.dispose();b=true};Element.implement({pin:function(h,f){if(!b){c()}if(this.getStyle("display")=="none"){return this}var j,k=window.getScroll();if(h!==false){j=this.getPosition(a?document.body:this.getOffsetParent());if(!this.retrieve("pin:_pinned")){var g={top:j.y-k.y,left:j.x-k.x};if(a&&!f){this.setStyle("position","fixed").setStyles(g)}else{var l=this.getOffsetParent(),i=this.getPosition(l),m=this.getStyles("left","top");if(l&&m.left=="auto"||m.top=="auto"){this.setPosition(i)}if(this.getStyle("position")=="static"){this.setStyle("position","absolute")}i={x:m.left.toInt()-k.x,y:m.top.toInt()-k.y};var e=function(){if(!this.retrieve("pin:_pinned")){return}var n=window.getScroll();this.setStyles({left:i.x+n.x,top:i.y+n.y})}.bind(this);this.store("pin:_scrollFixer",e);window.addEvent("scroll",e)}this.store("pin:_pinned",true)}}else{if(!this.retrieve("pin:_pinned")){return this}var l=this.getParent(),d=(l.getComputedStyle("position")!="static"?l:l.getOffsetParent());j=this.getPosition(d);this.store("pin:_pinned",false);var e=this.retrieve("pin:_scrollFixer");if(!e){this.setStyles({position:"absolute",top:j.y+k.y,left:j.x+k.x})}else{this.store("pin:_scrollFixer",null);window.removeEvent("scroll",e)}this.removeClass("isPinned")}return this},unpin:function(){return this.pin(false)},togglepin:function(){return this.pin(!this.retrieve("pin:_pinned"))}})})();